#!/bin/sh

DMENU='rofi -dmenu -p Mount-utility'
# Running from i3 key?
if [[ $1 == "i3" ]]; then
    i3-msg floating enable
fi

# Global variables
TITLE="Mount Utility"

# Populate list of mountable devices
deviceSources=$(ls /dev | grep "sd[b-z]")
deviceCount=$(echo $deviceSources | wc -w)

# Are there any devices?
if [[ $deviceCount == 0 ]]; then
    notify-send "No devices found"
    exit 1
fi

touch ~/list.txt
# Display list of devices that can be mounted
for ((device=1; device<=${deviceCount}; device+=1))
do
    curSource="/dev/"$(echo $deviceSources | cut -d " " -f${device})
    printf "%4s)   %-13s\n" ${device} ${curSource} >> ~/list.txt
done

printf "%4s)   Exit\n" "x" >> ~/list.txt

# Get input from user
input=$(cat ~/list.txt | $DMENU $*)

if echo $input | grep "Exit"
then
    rm ~/list.txt
    exit 0
else
    tomount=$(echo $input | cut -d " " -f2)
    echo $tomount
fi

if !(udevil mount ${tomount}); then
    notify-send "Input did not match any device"
fi
rm ~/list.txt
exit 0
