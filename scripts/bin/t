#!/bin/bash

# A very simple todo list manager

# Make the tasks directory
TASKDIR=~/.cache/tasks
mkdir -p $TASKDIR

# Find out the Taskfile
TASKFILE=$TASKDIR/$(cat $TASKDIR/taskfile)

# Check if an argument was given
if [[ $@ ]]; then

    case "$1" in

    # Finish the tasks given in sed format
    f)  sed -i "$2 d" $TASKFILE
        ;;
    # Sed substitution to edit the task
    s)  sed -i "$2 s/$3/${*:4}/g" $TASKFILE
        ;;
    # Change the task completely
    c)  sed -i "$2 s/.*/${*:3} ($(date --iso-8601))/g" $TASKFILE
        ;;
    # Open TASKFILE in editor
    e)  $EDITOR $TASKFILE
        ;;
    # Switch to a different TASKFILE
    t)  if [[ -n $2 ]]; then printf "%s" $2 > $TASKDIR/taskfile
        else printf "main" > $TASKDIR/taskfile  # Default
        fi
        ;;
    # List taskfiles
    l)  ls $TASKDIR | grep -v taskfile
        ;;
    # Append the task to the task list
    *)  printf "%s (%s)\n" "$*" "$(date --iso-8601)" >> $TASKFILE
        ;;
    esac

# If there was no argument simply display the tasks with line numbers
else
    printf "Tasks in %s\n" "$(basename $TASKFILE)"
    perl -E 'say "â”€" x 80'

    awk '{print NR") "$0}' $TASKFILE
fi
